<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<head>
    <meta charset="UTF-8">
    <title>Admin panel</title>
    <link th:href="@{/bootstrap/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
    <link th:href="@{/css/dashboard.css}" rel="stylesheet" media="screen"/>
</head>
<body>
<div th:replace="fragments/header :: header(${current.getEmail()}, ${current.getRolesToString()})"></div>
<div class="container-fluid">
    <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="sidebar-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/admin}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            Admin <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/user}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                            User
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
            <h2 class="mt-2 mb-2">Admin panel</h2>
            <ul class="nav nav-tabs" id="tab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="usersTableTab" data-toggle="tab" href="#usersTable" role="tab" aria-controls="table" aria-selected="true">Users Table</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="newUserTab" data-toggle="tab" href="#newUser" role="tab" aria-controls="table" aria-selected="true">New User</a>
                </li>
            </ul>
            <div class="tab-content" id="tabContent">
                <div class="tab-pane show active" id="usersTable" role="tabpanel" aria-labelledby="tableTab">
                    <div class="card-header">All Users</div>
                    <div class="table-responsive card-body">
                        <table class="table table-striped table-sm">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Age</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="user : ${users}">
                                <td th:text="${user.getId()}" ></td>
                                <td th:text="${user.getUsername()}"></td>
                                <td th:text="${user.getLastname()}"></td>
                                <td th:text="${user.getAge()}"></td>
                                <td th:text="${user.getEmail()}"></td>
                                <td th:text="${user.getRolesToString()}"></td>
                                <td>
                                    <button th:href="@{/admin/get/{id}(id=${user.getId()})}"
                                            type="button" class="btn btn-info btn-edit" data-toggle="modal" data-target="#edit">
                                        Edit
                                    </button>
                                </td>
                                <td>
                                    <button th:href="@{/admin/get/{id}(id=${user.getId()})}"
                                            type="button" class="btn btn-danger btn-delete" data-toggle="modal" data-target="#delete">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="newUser" role="tabpanel" aria-labelledby="newUserTab">
                    <div class="card-header">New User Form</div>
                    <div class="container card-body">
                        <div class="row w-100 justify-content-center">
                            <form class="w-25" th:action="@{/admin/new}" th:method="POST" th:object="${user}">
                                <div class="form-group text-center">
                                    <label for="username" class="font-weight-bold">First name</label>
                                    <input type="text" th:field="*{username}" id="username" class="form-control" required>

                                    <label for="lastname" class="font-weight-bold">Last name</label>
                                    <input type="text" th:field="*{lastname}" id="lastname" class="form-control" required>

                                    <label for="age" class="font-weight-bold">Age</label>
                                    <input type="text" th:field="*{age}" id="age" class="form-control">

                                    <label for="email" class="font-weight-bold">Email</label>
                                    <input type="email" th:field="*{email}" id="email" class="form-control" required>

                                    <label for="password" class="font-weight-bold">Password: </label>
                                    <input type="password" th:field="*{password}" id="password" class="form-control">

                                    <label for="role" class="font-weight-bold">Role</label>
                                    <select th:field="*{roles}" multiple class="form-control" id="role" size="2">
                                        <option th:value="ROLE_ADMIN" th:text="ADMIN"></option>
                                        <option th:value="ROLE_USER" th:text="USER"></option>
                                    </select>
                                    <input class="btn btn-success mt-4" type="submit" value="add new user">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Modal Edit -->
    <div class="modal fade" id="edit" tabindex="-1" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit user</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form th:method="PATCH" th:object="${user}" id="edit-user">
                        <div class="form-group text-center w-50" style="margin: 0 auto;">
                            <label for="edit-id" class="font-weight-bold">ID</label>
                            <input type="text" th:field="*{id}" id="edit-id" class="form-control" disabled>

                            <label for="edit-username" class="font-weight-bold">First name</label>
                            <input type="text" th:field="*{username}" id="edit-username" class="form-control" required>

                            <label for="edit-lastname" class="font-weight-bold">Last name</label>
                            <input type="text" th:field="*{lastname}" id="edit-lastname" class="form-control" required>

                            <label for="edit-age" class="font-weight-bold">Age</label>
                            <input type="text" th:field="*{age}" id="edit-age" class="form-control" required>

                            <label for="edit-email" class="font-weight-bold">Email</label>
                            <input type="email" th:field="*{email}" id="edit-email" class="form-control" required>

                            <label for="edit-password" class="font-weight-bold">Password: </label>
                            <input type="password" th:field="*{password}" id="edit-password" class="form-control" required>

                            <label for="edit-role" class="font-weight-bold">Role</label>
                            <select th:field="*{roles}" multiple class="form-control" id="edit-role" size="2">
                                <option th:value="ROLE_ADMIN" th:text="ADMIN"></option>
                                <option th:value="ROLE_USER" th:text="USER"></option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" form="edit-user" class="btn btn-primary">Edit</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Delete -->
    <div class="modal fade" id="delete" tabindex="-1" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete user</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form th:method="DELETE" id="delete-user">
                        <div class="form-group text-center w-50" style="margin: 0 auto;">
                            <label for="delete-id" class="font-weight-bold">ID</label>
                            <input type="text" id="delete-id" class="form-control" disabled>

                            <label for="delete-username" class="font-weight-bold">First name</label>
                            <input type="text" id="delete-username" class="form-control" disabled>

                            <label for="delete-lastname" class="font-weight-bold">Last name</label>
                            <input type="text" id="delete-lastname" class="form-control" disabled>

                            <label for="delete-age" class="font-weight-bold">Age</label>
                            <input type="text" id="delete-age" class="form-control" disabled>

                            <label for="delete-email" class="font-weight-bold">Email</label>
                            <input type="email" id="delete-email" class="form-control" disabled>

                            <label for="delete-role" class="font-weight-bold">Role</label>
                            <select multiple class="form-control" id="delete-role" size="2" disabled>
                                <option th:text="ADMIN"></option>
                                <option th:text="USER"></option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" form="delete-user" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/modal.js}"></script>
<script th:src="@{/jquery/jquery.min.js}"></script>
<script th:src="@{/popper/popper.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
</body>
</html>